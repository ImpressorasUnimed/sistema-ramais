<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Cat√°logo de Ramais</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
:root {
  --bg: rgb(0, 64, 26);
  --card: rgb(0 0 0 / 8%);
  --border: #000000;
  --accent: rgb(244, 121, 32);
  --text: #fbfbfb;
  --muted: rgb(244, 121, 32);
}

* { box-sizing: border-box; }

body {
  margin: 0;
  padding: 40px;
  font-family: "Inter", -apple-system, BlinkMacSystemFont, "Segoe UI",
                Roboto, Helvetica, Arial, sans-serif;

  background:
    linear-gradient(180deg, rgba(0,64,26,.85), rgba(0,64,26,.95)),
    url("https://imgur.com/GMkHUDl.png");

  background-size: cover;
  background-position: center;
  background-attachment: fixed;

  color: var(--text);
  display: flex;
}

/* ===== SIDEBAR ===== */
#sidebar {
  width: 240px;
  margin-right: 30px;
  display: none;
}

#sidebar .menu {
  display: flex;
  flex-direction: column;
  gap: 12px;
}

#sidebar button {
  background: transparent;
  color: var(--text);
  border: 1px solid var(--border);
  padding: 14px 18px;
  border-radius: 14px;
  text-align: left;
  cursor: pointer;
}

#sidebar button:hover {
  background: var(--accent);
  color: #000;
}

/* ===== MOBILE ===== */
#mobileToggle {
  display: none;
  font-size: 22px;
  background: transparent;
  color: var(--accent);
  border: none;
  cursor: pointer;
  margin-bottom: 20px;
}

@media (max-width: 900px) {
  body {
    flex-direction: column;
    padding: 20px;
  }

  #sidebar {
    position: fixed;
    inset: 0 auto 0 0;
    background: linear-gradient(180deg, rgb(0,64,26), rgb(0,40,16));
    padding: 30px 20px;
    transform: translateX(-100%);
    transition: transform .3s ease;
    z-index: 1000;
  }

  #sidebar.ativo { transform: translateX(0); }
  #mobileToggle { display: inline-block; }
}

#main { flex: 1; }

.menu, .section {
  background: var(--card);
  border-radius: 20px;
  padding: 28px;
  border: 1px solid var(--border);
  box-shadow: 0 12px 40px rgba(0,0,0,.7);
  margin-bottom: 25px;
  backdrop-filter: blur(6px);
}

button {
  background: var(--accent);
  color: #000;
  border: none;
  border-radius: 14px;
  padding: 12px 22px;
  font-weight: 600;
  cursor: pointer;
}

button.secondary {
  background: transparent;
  color: var(--accent);
  border: 1px solid var(--border);
}

input, select {
  width: 100%;
  padding: 13px 16px;
  border-radius: 14px;
  border: 1px solid var(--border);
  background: rgba(0,0,0,.25);
  color: var(--text);
  margin-bottom: 16px;
}

table {
  width: 100%;
  border-collapse: separate;
  border-spacing: 0 12px;
}

th {
  color: var(--muted);
  font-size: 12px;
  text-align: left;
}

td {
  background: rgba(0,0,0,.25);
  padding: 16px;
  border-radius: 14px;
  border: 1px solid var(--border);
}

.actions button {
  background: transparent;
  color: var(--accent);
  padding: 0;
  margin-right: 10px;
}
</style>
</head>

<body>

<div id="sidebar">
  <div class="menu">
    <button onclick="mostrarSecao('cadastro'); fecharSidebar()">‚ûï Adicionar</button>
    <button onclick="alert('Use Editar na tabela')">‚úèÔ∏è Editar</button>
    <button onclick="alert('Use Excluir na tabela')">üóëÔ∏è Excluir</button>
  </div>
</div>

<div id="main">

<button id="mobileToggle" onclick="toggleSidebar()">‚ò∞ Menu</button>

<div style="margin-bottom: 25px;">
  <img 
    src="https://i.imgur.com/RGuCJcQ.png"
    alt="Cat√°logo de Ramais"
    style="max-width: 300px; width: 100%; height: auto;"
  >
</div>

<div class="menu">
  <button id="btnCadastro" onclick="mostrarSecao('cadastro')">Cadastrar Ramal</button>
  <button class="secondary" onclick="mostrarSecao('pesquisa')">Pesquisar</button>
  <button class="secondary" onclick="login()">üîê Acesso Administrativo</button>
</div>

<div id="secaoCadastro" class="section" style="display:none;">
  <h3>Cadastrar / Editar</h3>
  <input type="hidden" id="editId">
  <input id="setor" placeholder="Setor">
  <input id="nome" placeholder="Nome">
  <input id="ramal" placeholder="Ramal">
  <select id="tipo">
    <option value="">Tipo</option>
    <option>IP</option>
    <option>3CX</option>
  </select>
  <button onclick="salvarRamal()">Salvar</button>
  <button class="secondary" onclick="cancelar()">Cancelar</button>
</div>

<div id="secaoPesquisa" class="section">
  <h3>Pesquisar</h3>
  <input id="busca" placeholder="Buscar por setor, nome ou ramal" onkeyup="buscarRamal()">
  <table>
    <thead>
      <tr>
        <th>Setor</th>
        <th>Nome</th>
        <th>Ramal</th>
        <th>Tipo</th>
        <th>A√ß√µes</th>
      </tr>
    </thead>
    <tbody id="tabelaRamais"></tbody>
  </table>
</div>

</div>

<script>
const API_URL = "https://sheetdb.io/api/v1/6uet0g8pur14t";
const SENHA = "asd!@065";
const TEMPO_SESSAO = 15 * 60 * 1000;

let ramais = [];
let autenticado = false;
let timerSessao;

verificarSessao();
mostrarSecao("pesquisa");
carregarRamais();
bloquearAdmin();

function login() {
  const s = prompt("Senha administrativa:");
  if (s === SENHA) {
    autenticado = true;
    localStorage.setItem("sessaoAdmin", Date.now());
    iniciarTimer();
    liberarAdmin();
    alert("Acesso liberado por 15 minutos");
  } else alert("Senha incorreta");
}

function verificarSessao() {
  const i = localStorage.getItem("sessaoAdmin");
  if (i && Date.now() - i < TEMPO_SESSAO) {
    autenticado = true;
    iniciarTimer();
    liberarAdmin();
  } else encerrarSessao();
}

function iniciarTimer() {
  clearTimeout(timerSessao);
  timerSessao = setTimeout(encerrarSessao, TEMPO_SESSAO);
}

function encerrarSessao() {
  autenticado = false;
  localStorage.removeItem("sessaoAdmin");
  bloquearAdmin();
  fecharSidebar();
  listarRamais(ramais);
}

function liberarAdmin() {
  sidebar.style.display = "block";
  btnCadastro.style.display = "inline-block";
}

function bloquearAdmin() {
  sidebar.style.display = "none";
  btnCadastro.style.display = "none";
}

function toggleSidebar() { sidebar.classList.toggle("ativo"); }
function fecharSidebar() { sidebar.classList.remove("ativo"); }

function mostrarSecao(s) {
  secaoCadastro.style.display = s === "cadastro" ? "block" : "none";
  secaoPesquisa.style.display = s === "pesquisa" ? "block" : "none";
}

async function carregarRamais() {
  const res = await fetch(API_URL);
  ramais = await res.json();
  listarRamais(ramais);
}

function listarRamais(lista) {
  tabelaRamais.innerHTML = "";
  lista.forEach(r => {
    tabelaRamais.innerHTML += `
      <tr>
        <td>${r.setor}</td>
        <td>${r.nome}</td>
        <td>${r.ramal}</td>
        <td>${r.tipo}</td>
        <td class="actions">
          ${autenticado ? `
          <button onclick="editar('${r.id}')">Editar</button>
          <button onclick="excluir('${r.id}')">Excluir</button>` : ``}
        </td>
      </tr>`;
  });
}

function buscarRamal() {
  const t = busca.value.toLowerCase();
  listarRamais(ramais.filter(r =>
    r.setor.toLowerCase().includes(t) ||
    r.nome.toLowerCase().includes(t) ||
    r.ramal.includes(t)
  ));
}

function editar(id) {
  if (!autenticado) return;
  const r = ramais.find(x => x.id === id);
  setor.value = r.setor;
  nome.value = r.nome;
  ramal.value = r.ramal;
  tipo.value = r.tipo;
  editId.value = r.id;
  mostrarSecao("cadastro");
}

async function salvarRamal() {
  if (!autenticado) return alert("Sess√£o expirada");
  if (!setor.value || !nome.value || !ramal.value || !tipo.value)
    return alert("Preencha todos os campos");

  const dados = {
    id: editId.value || crypto.randomUUID(),
    setor: setor.value,
    nome: nome.value,
    ramal: ramal.value,
    tipo: tipo.value
  };

  await fetch(editId.value ? `${API_URL}/id/${editId.value}` : API_URL, {
    method: editId.value ? "PUT" : "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ data: editId.value ? dados : [dados] })
  });

  cancelar();
  carregarRamais();
}

async function excluir(id) {
  if (!autenticado) return;
  if (confirm("Deseja excluir este ramal?")) {
    await fetch(`${API_URL}/id/${id}`, { method: "DELETE" });
    carregarRamais();
  }
}

function cancelar() {
  setor.value = nome.value = ramal.value = tipo.value = editId.value = "";
  mostrarSecao("pesquisa");
}
</script>

</body>
</html>
